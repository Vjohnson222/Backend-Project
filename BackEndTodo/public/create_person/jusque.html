<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home</title>
  <link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"
/>
<link rel="stylesheet" href="styles.css" />
<style>
  * {
    box-sizing: border-box;
  }
  
  /* Create three equal columns that floats next to each other */
  .column {
    float: left;
    width: 33.33%;
    padding: 10px;
    height: 300px; /* Should be removed. Only for demonstration */
  }
  
  /* Clear floats after the columns */
  .row:after {
    content: "";
    display: table;
    clear: both;
  }
  </style>
</head>

<body>
  <!-- Nav Starts Here -->

  <nav class="navheight">
    <div class="nav-center">
      <div class="nav-header">
        <svg height="140" width="140" class="sot2">            
          <defs>
            <filter id="f3" x="0" y="0" width="200%" height="200%">
              <feOffset result="offOut" in="SourceAlpha" dx="20" dy="20" />
              <feGaussianBlur result="blurOut" in="offOut" stdDeviation="10" />
              <feBlend in="SourceGraphic" in2="blurOut" mode="normal" />
            </filter>
          </defs>
          <rect width="90" height="70" stroke="white" stroke-width="2"
          fill="grey" filter="url(#f3)" />
        </svg>
        
         <button class="nav-toggle">
          <i class="fas fa-bars"></i>
        </button>
        
      </div>
      <ul class="links">
        <li>
          <a href="/">Home</a>
  
        </li>
        <li>
          <a href="#">Lights</a>
        </li>
        <li>
          <a href="#">Camera</a>
        </li>
        <li>
        <a href="/create_person">Action</a>
          </li>
      </ul>
      <ul class="social-icons">
        <li>
          <a href="https://www.facebook.com">
            <i class="fab fa-facebook"></i>
          </a>
        </li>
        <li>
          <a href="https://www.twitter.com">
            <i class="fab fa-twitter"></i>
          </a>
        </li>
                  <li>
          <a href="https://www.linkedin.com">
            <i class="fab fa-linkedin"></i>
          </a>
        </li>
              </ul>
    </div>
  </nav>
<br>
  <div> <h3 style="text-align: center; ">Cast And Crew</h3></div>
<br>
<div class="review">      

  <h3 class="script" style="margin-left:30px;  font-family: 'Dancing Script';">Talent<span style="color:transparent;">........................................</span> Tasks</h5>
  <hr> <br>
  <h4 style=" color:white;">Select Name to Assign and see individual tasks</h4>
  <br>

  
  <!-- -------------------------------- Column 1 --------------------------------  -->

   <!-- #2 - identified  -->
  <div class="column" id="people"> </div>



     <!-- -----------------------------column  2 -->

     <!-- Yep they both seem to do the same thing 
     -->

     
     <!-- #3 - identified  -->
     <div class=" right" id="todos"> </div>
  <!-- #4 - identified This shows the todos -->

  <div id="added_todos"  class=" mid" style="display:none">
    
<!-- -----------------------------column  3 -->
    <!-- #6 - identified  -->
    <form id="add_todos_form">
      
     <!-- #5 - identified  Buttttt -->
    <h5 style="font-style: italic;">Add to: <span id="person_name"></span></h5>

      <label for="name">New Todo:</label>
      <input type="text" id="name" name="name" required>
      <button type="submit">Add Todo</button>
    </form>


  </div>
  <br>
 
  
   <br>
  
</div>
<!-- Note you will need 7 todo_id here to delete anything 
Hey also try this, try not to change your face here in fat. only on jake
it will make the transformation make sense later

so for now
complete the server then come back here and identify everything tha got changed there for here's purpose-->
<!-- Thanks for the notes Frost  -->
<script>
// #1 The ID calls work very well so far
const people = document.getElementById('people');
const todos = document.getElementById('todos');
const added_todos = document.getElementById('added_todos');
const person_name = document.getElementById('person_name');
const add_todos_form = document.getElementById('add_todos_form');
        // const change_grade_div = document.getElementById('change_grade');
        // const change_grade_form = document.getElementById('change_students_grade');

        //Below and above I don't think we'll need either 
        const todo_name = document.getElementById('todo_name');

        let current_person_id = null;
        let current_todo_id = null;


               //#6---------------------DELETE    


// -#2-------------------------------NEXT We have a fetch request that will render
//All People fromthe DB andnot just 1 person - This is identicaland should be fine

fetch("/api/people").then(res => res.json()).then(data => {
  console.log(data);
  people.innerHTML = `<ul>${renderPeople(data)}</ul>`;
});

//#3 -------------------------------------Render People
function renderPeople(people) {
  return people.map((person) => {
    return `
      <li class="person" onclick="getTodos('${person.id}', '${person.name}')">  ${person.name} </li>
    `
  }).join("");
}


//#3 -------------------------------------Get Todos
function getTodos(id, name) {
  current_person_id = id;
  person_name.innerHTML = name;
  added_todos.style.display = "block";
  console.log(id)

  fetch(`/api/people/${id}/todos`).then(res => res.json()).then(data => {
    console.log(data)
    todos.innerHTML = `<div>${renderTodos(data.todos)}</div>`
  })
}


        //#6---------------------DELETE    

        function delete_todos(todo_id) {
  fetch(`/api/todos/${todo_id}`, {  // use the todo_id parameter in the URL
    method: 'DELETE',
    headers: { 'Content-Type': 'application/json' },
  })
    .then(res => res.json())
    .then(data => {
      console.log(data);
      window.location = '/';
    })
    .catch(error => {
      console.error('Error deleting todo:', error);
    });
}


//# --------------this hits different-----------------------Render Todos

function renderTodos(todos) {
  return todos
    .map(todo => {
      return `
        <div style="display: flex; flex-direction: row;">
          <span> ${todo.name}</span>
          <button onClick="delete_todos('${todo.id}')">Delete Todos</button>
        </div>
      `;
    })
    .join("");
}





//#5----------This MIGHT be the missing piece-----------Add todos form

add_todos_form.addEventListener("submit", (event) => {
  event.preventDefault();
  console.log(event.target.name.value)
  console.log(event.target)
// So this is how things persisted to the database and perhaps why no email area cause you did have 1
  fetch(`/api/people/${current_person_id}/todos`, {
    method: 'POST',
    headers: { 'Content-Type': "application/json" },
    body: JSON.stringify({
      name: event.target.name.value
    })
  }).then(res => res.json()).then(data => {
                console.log(data);
                window.location = "/create_person/index.html";            })
        })





</script>
</body> 
</html>